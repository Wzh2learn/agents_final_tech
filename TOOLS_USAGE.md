# ğŸ› ï¸ å·¥å…·ä½¿ç”¨è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜é¡¹ç›®ä¸­æ‰€æœ‰å·¥å…·çš„ç”¨é€”ã€è°ƒç”¨è·¯å¾„å’Œä½¿ç”¨çŠ¶æ€ã€‚

**æœ€åæ›´æ–°**: 2026-01-04

---

## ğŸ“Š å·¥å…·ä½¿ç”¨æ¦‚è§ˆ

| ç±»åˆ« | å·¥å…·æ•°é‡ | è¯´æ˜ |
|------|---------|------|
| Agentç›´æ¥ä½¿ç”¨ | 15ä¸ª | Agentå¯ä»¥ç›´æ¥è°ƒç”¨çš„å·¥å…· |
| åº•å±‚ä¾èµ– | 8ä¸ª | è¢«å…¶ä»–å·¥å…·æˆ–Bizå±‚ä½¿ç”¨ |
| **æ€»è®¡** | **23ä¸ª** | å…¨éƒ¨å·¥å…·å‡åœ¨ä½¿ç”¨ä¸­ |

---

## 1ï¸âƒ£ Agentç›´æ¥ä½¿ç”¨çš„å·¥å…·

è¿™äº›å·¥å…·é€šè¿‡`src/agents/agent.py`ä¸­çš„toolsåˆ—è¡¨ç›´æ¥æš´éœ²ç»™Agentã€‚

### ğŸ“„ æ–‡æ¡£å¤„ç†ç±» (3ä¸ª)

#### 1.1 `document_processor`
- **æ–‡ä»¶**: `src/tools/document_processor.py`
- **ç”¨é€”**: è§£ææ–‡æ¡£å¹¶æå–å»ºè´¦è§„åˆ™ä¸ºç»“æ„åŒ–Markdownè¡¨æ ¼
- **è°ƒç”¨è·¯å¾„**: Agent â†’ document_processor
- **è¾“å…¥**: 
  - `file_path`: æ–‡æ¡£è·¯å¾„ (æ”¯æŒ .txt, .md, .pdf, .docx, .csv, .json, .yaml, .yml)
  - `role`: å¤„ç†è§’è‰² (product_manager/tech_developer/sales_engineer/default)
- **è¾“å‡º**: Markdownè¡¨æ ¼æ ¼å¼çš„è§„åˆ™å­—å…¸
- **ç‰¹æ€§**: 
  - æ”¯æŒå¤šè§’è‰²è§†è§’
  - è‡ªåŠ¨æå–è§¦å‘æ¡ä»¶ã€æ‰§è¡ŒåŠ¨ä½œã€é…ç½®å‚æ•°ç­‰
  - ç¬¦åˆWF_DocumentProcessor_v1å·¥ä½œæµå®šä¹‰

#### 1.2 `validate_rules`
- **æ–‡ä»¶**: `src/tools/document_processor.py`
- **ç”¨é€”**: å®¡æ ¸æå–çš„è§„åˆ™è¡¨æ ¼æ˜¯å¦åˆç†
- **è°ƒç”¨è·¯å¾„**: Agent â†’ validate_rules
- **è¾“å…¥**: `rules_table` (Markdownæ ¼å¼çš„è§„åˆ™è¡¨æ ¼)
- **è¾“å‡º**: å®¡æ ¸ç»“æœå’Œæ”¹è¿›å»ºè®®
- **ç‰¹æ€§**: æ£€æŸ¥å®Œæ•´æ€§ã€å‡†ç¡®æ€§ã€é€»è¾‘æ€§ã€å¯æ“ä½œæ€§

#### 1.3 `classify_query`
- **æ–‡ä»¶**: `src/tools/qa_agent.py`
- **ç”¨é€”**: åˆ¤æ–­ç”¨æˆ·æŸ¥è¯¢çš„ç±»å‹
- **è°ƒç”¨è·¯å¾„**: Agent â†’ classify_query
- **è¾“å…¥**: `query` (ç”¨æˆ·æŸ¥è¯¢å†…å®¹)
- **è¾“å‡º**: æŸ¥è¯¢ç±»å‹ (rule_query/general_qa/document_analysis)
- **ç‰¹æ€§**: å¸®åŠ©Agenté€‰æ‹©åˆé€‚çš„å¤„ç†ç­–ç•¥

---

## 2ï¸âƒ£ åº•å±‚ä¾èµ–å·¥å…·

è¿™äº›å·¥å…·ä¸ç›´æ¥æš´éœ²ç»™Agentï¼Œè€Œæ˜¯è¢«å…¶ä»–å·¥å…·æˆ–Bizå±‚ä½¿ç”¨ã€‚

### ğŸ“‚ æ–‡æ¡£åŠ è½½ç±» (2ä¸ª)

#### 2.1 `load_document`
- **æ–‡ä»¶**: `src/tools/document_loader.py`
- **ç”¨é€”**: åŠ è½½å„ç§æ ¼å¼çš„æ–‡æ¡£
- **è°ƒç”¨è€…**: `document_processor`, `RAGService`
- **æ”¯æŒæ ¼å¼**: .txt, .md, .pdf, .docx, .csv, .json, .yaml, .yml

#### 2.2 `get_document_info`
- **æ–‡ä»¶**: `src/tools/document_loader.py`
- **ç”¨é€”**: è·å–æ–‡æ¡£å…ƒä¿¡æ¯
- **è°ƒç”¨è€…**: `RAGService`

---

## 3ï¸âƒ£ æ–°å¢åŠŸèƒ½è¯¦è§£

### ğŸ†• çˆ¶å­åˆ†æ®µæ¨¡å¼ (hierarchical_split)

**ä½¿ç”¨åœºæ™¯**:
- é•¿æ–‡æ¡£éœ€è¦ä¿æŒä¸Šä¸‹æ–‡å®Œæ•´æ€§
- éœ€è¦åŒæ—¶æ”¯æŒæ¦‚è§ˆå’Œè¯¦ç»†æ£€ç´¢

**ä½¿ç”¨æ–¹æ³•**:
```python
# åœ¨RAGServiceä¸­å¯ç”¨çˆ¶å­åˆ†æ®µ
from biz.rag_service import get_rag_service

rag_service = get_rag_service()
result = await rag_service.ingest_file(
    file_path="document.md",
    metadata={"source": "è§„åˆ™æ–‡æ¡£"},
    use_hierarchical=True
)
```

### ğŸ†• å¢å¼ºç­”æ¡ˆæº¯æº (get_traceability)

**æ–°å¢å­—æ®µ**:
- `location`: æ–‡æ¡£ä½ç½®ï¼ˆç« èŠ‚/é¡µç /è¡Œå·ï¼‰
- `quote`: å¼•ç”¨ç‰‡æ®µ
- `context`: å®Œæ•´ä¸Šä¸‹æ–‡

---

## 4ï¸âƒ£ è¿è¡Œä¸æµ‹è¯•è¯´æ˜

### å¦‚ä½•è¿è¡Œé¡¹ç›®
1. ç¡®ä¿å·²æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ `venv`
2. è®¾ç½®ç¯å¢ƒå˜é‡ `SILICONFLOW_API_KEY`
3. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ:
   ```bash
   # æ¨èæ–¹å¼ (ç¡®ä¿æ¨¡å—è·¯å¾„æ­£ç¡®)
   set PYTHONPATH=%PYTHONPATH%;%CD%\src
   python src/main.py -m http -p 5000
   ```
   æˆ–è€…ç›´æ¥è¿è¡Œæ ¹ç›®å½•ä¸‹çš„ `run.bat` (å·²æ›´æ–°)ã€‚

### å¸¸è§é”™è¯¯æ’æŸ¥
- **ImportError**: å¦‚æœå‡ºç° `attempted relative import beyond top-level package`ï¼Œè¯·ç¡®ä¿æ‚¨æ˜¯åœ¨æ ¹ç›®å½•è¿è¡Œï¼Œå¹¶ä¸”å·²å°† `src` ç›®å½•åŠ å…¥ `PYTHONPATH`ã€‚
