<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>协作会话 - 建账规则助手</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='collaboration.css') }}">
</head>
<body>
    <!-- 登录/加入会话对话框 -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <h2>🤝 加入协作会话</h2>
            </div>
            <div class="modal-body">
                <!-- 昵称输入 -->
                <div class="form-group">
                    <label>你的昵称</label>
                    <input type="text" id="nicknameInput" placeholder="输入你的昵称" maxlength="20">
                </div>

                <!-- 头像颜色选择 -->
                <div class="form-group">
                    <label>选择头像颜色</label>
                    <div class="color-picker" id="colorPicker">
                        <div class="color-option" data-color="#667eea" style="background: #667eea;"></div>
                        <div class="color-option" data-color="#4CAF50" style="background: #4CAF50;"></div>
                        <div class="color-option" data-color="#FF9800" style="background: #FF9800;"></div>
                        <div class="color-option" data-color="#E91E63" style="background: #E91E63;"></div>
                        <div class="color-option" data-color="#00BCD4" style="background: #00BCD4;"></div>
                        <div class="color-option" data-color="#9C27B0" style="background: #9C27B0;"></div>
                    </div>
                </div>

                <!-- 会话选择 -->
                <div class="form-group">
                    <label>选择会话</label>
                    <select id="sessionSelect">
                        <option value="">-- 选择现有会话 --</option>
                    </select>
                </div>

                <!-- 或者创建新会话 -->
                <div class="divider">或者创建新会话</div>

                <div class="form-group">
                    <label>会话名称</label>
                    <input type="text" id="sessionNameInput" placeholder="输入新会话名称" maxlength="50">
                </div>

                <div class="form-group">
                    <label>会话描述（可选）</label>
                    <textarea id="sessionDescInput" placeholder="输入会话描述" rows="2" maxlength="200"></textarea>
                </div>

                <button class="btn btn-primary" id="joinBtn">加入会话</button>
            </div>
        </div>
    </div>

    <!-- 主界面 -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- 侧边栏：会话信息 + 在线用户 -->
        <div class="sidebar">
            <div class="session-info">
                <h2 id="sessionTitle">会话名称</h2>
                <p id="sessionDesc">会话描述</p>
                <div class="session-meta">
                    <span id="sessionId">ID: --</span>
                </div>
            </div>

            <!-- 在线用户 -->
            <div class="online-users">
                <h3>在线用户</h3>
                <div class="user-list" id="userList">
                    <!-- 动态生成 -->
                </div>
            </div>

            <!-- 角色选择 -->
            <div class="role-selector">
                <h3>当前角色</h3>
                <div class="current-role">
                    <span id="currentRoleText">未选择</span>
                </div>
                <div class="role-buttons">
                    <button class="role-btn" data-role="a">👔 产品经理</button>
                    <button class="role-btn" data-role="b">💻 技术开发</button>
                    <button class="role-btn" data-role="c">📊 销售运营</button>
                    <button class="role-btn" data-role="d">🔧 工程师</button>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="actions">
                <button class="action-btn" id="leaveBtn">离开会话</button>
                <button class="action-btn" id="clearBtn">清空聊天</button>
            </div>
        </div>

        <!-- 主聊天区域 -->
        <div class="main">
            <!-- 聊天消息 -->
            <div class="chat-container" id="chatContainer">
                <!-- 动态生成消息 -->
            </div>

            <!-- 输入区域 -->
            <div class="input-area">
                <div class="typing-indicator" id="typingIndicator">
                    <span id="typingText">有人正在输入...</span>
                </div>
                <div class="input-wrapper">
                    <textarea id="messageInput" placeholder="输入你的问题... (Shift+Enter 换行，Enter 发送)" rows="3"></textarea>
                    <button class="send-btn" id="sendBtn">发送</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载状态 -->
    <div class="loading" id="loadingIndicator">
        <div class="spinner"></div>
        <p>AI 正在思考...</p>
    </div>

    <script src="{{ url_for('static', filename='collaboration.js') }}"></script>
</body>
</html>
